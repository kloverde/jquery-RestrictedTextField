<!DOCTYPE html>

<html>
   <head>
      <meta charset="utf-8"/>

      <title>QUnit basic example</title>

      <link rel="stylesheet" href="dep/qunit.css"/>

      <script type="text/javascript" src="dep/jquery.js"></script>
      <script type="text/javascript" src="dep/jquery.simulate.js"></script>
      <script type="text/javascript" src="dep/bililiteRange.js"></script>
      <script type="text/javascript" src="dep/jquery.simulate.key-sequence.js"></script>
      <script type="text/javascript" src="dep/qunit.js"></script>
      <script type="text/javascript" src="../src/jquery.restrictedtextfield.js"></script>

      <script type="text/javascript">
         var field = "#field";
         var moduleCfg;
         var key = [];

         var _inputIgnored,
             _validationFailed,
             _validationSuccess;

         ( function() {
            $( document ).ready( function() {
               moduleCfg = {
                  beforeEach : function() {
                     _inputIgnored = false;
                     _validationFailed = false;
                     _validationSuccess = false;

                     // I know.  Clearing it before replacing it is unnecessary.  But, being able
                     // to watch it be destroyed by stepping through in a debugger is reassuring.
                     $( "#txtDiv" ).html( "" );
                     $( "#txtDiv" ).html( "<input type='text' id='field'/>" );

                     $( "#field" ).on( "inputIgnored", function() {
                        _inputIgnored = true;
                     } );

                     $( "#field" ).on( "validationFailed", function() {
                        _validationFailed = true;
                     } );

                     $( "#field" ).on( "validationSuccess", function() {
                        _validationSuccess = true;
                     } );
                  }
               };
            } );
         } )();

         $( document ).ready( function() {
            QUnit.module( "Type_alpha", moduleCfg );

            QUnit.asyncTest( "alpha_onInput_success_acceptUppercase", function(assert) {
               var box = $( field ).restrictedTextField( { type : "alpha" } );
               var str = "A";

               $( "#field" ).simulate( "key-sequence", {
                  sequence : str,
                  delay    : 1,
                  callback : function() {
                     start();

                     assert.equal( box.val(), str, "The text box has the entered value" );
                     assert.ok( _validationSuccess, "Validation success event fired" );
                     assert.notOk( _validationFailed, "Validation failure event did not fire" );
                     assert.notOk( _inputIgnored, "Input ignored event did not fire" );
                  }
               } );
            } );

            QUnit.asyncTest( "alpha_onInput_success_acceptLowercase", function(assert) {
               var box = $( field ).restrictedTextField( { type : "alpha" } );
               var str = "a";

               $( "#field" ).simulate( "key-sequence", {
                  sequence : str,
                  delay    : 1,
                  callback : function() {
                     start();

                     assert.equal( box.val(), str, "The text box has the entered value" );
                     assert.ok( _validationSuccess, "Validation success event fired" );
                     assert.notOk( _validationFailed, "Validation failure event did not fire" );
                     assert.notOk( _inputIgnored, "Input ignored event did not fire" );
                  }
               } );
            } );

            QUnit.asyncTest( "alpha_onInput_success_rejectDigit", function(assert) {
               var box = $( field ).restrictedTextField( { type : "alpha" } );
               var str = "1";

               $( "#field" ).simulate( "key-sequence", {
                  sequence : str,
                  delay    : 1,
                  callback : function() {
                     start();

                     // TODO:  FAILS.  Looks like jquery.simulate.key-sequence.js is probably using $.val() instead of actually simulating the keypress.
                     assert.equal( box.val(), "", "The text box does not have the entered value" );

                     assert.notOk( _validationSuccess, "Validation success event did not fire" );
                     assert.notOk( _validationFailed, "Validation failure event did not fire" );
                     assert.ok( _inputIgnored, "Input ignored event did not fire" );
                  }
               } );
            } );

            QUnit.module( "Type_upperAlpha", moduleCfg );

            QUnit.asyncTest( "alpha_onInput_success_acceptUppercase", function(assert) {
               var box = $( field ).restrictedTextField( { type : "upperAlpha" } );
               var str = "A";

               $( "#field" ).simulate( "key-sequence", {
                  sequence : str,
                  delay    : 1,
                  callback : function() {
                     start();

                     assert.equal( box.val(), str, "The text box has the entered value" );
                     assert.ok( _validationSuccess, "Validation success event fired" );
                     assert.notOk( _validationFailed, "Validation failure event did not fire" );
                     assert.notOk( _inputIgnored, "Input ignored event did not fire" );
                  }
               } );
            } );

            QUnit.asyncTest( "alpha_onInput_success_rejectLowercase", function(assert) {
               var box = $( field ).restrictedTextField( { type : "upperAlpha" } );
               var str = "a";

               $( "#field" ).simulate( "key-sequence", {
                  sequence : str,
                  delay    : 1,
                  callback : function() {
                     start();

                     assert.equal( box.val(), str, "The text box does not have the entered value" );
                     assert.notOk( _validationSuccess, "Validation success event did not fire" );
                     assert.notOk( _validationFailed, "Validation failure event did not fire" );
                     assert.ok( _inputIgnored, "Input ignored event fired" );
                  }
               } );
            } );

            QUnit.asyncTest( "alpha_onInput_success_rejectDigit", function(assert) {
               var box = $( field ).restrictedTextField( { type : "upperAlpha" } );
               var str = "1";

               $( "#field" ).simulate( "key-sequence", {
                  sequence : str,
                  delay    : 1,
                  callback : function() {
                     start();

                     // TODO:  FAILS.  Looks like jquery.simulate.key-sequence.js is probably using $.val() instead of actually simulating the keypress.
                     assert.equal( box.val(), "", "The text box does not have the entered value" );

                     assert.notOk( _validationSuccess, "Validation success event did not fire" );
                     assert.notOk( _validationFailed, "Validation failure event did not fire" );
                     assert.ok( _inputIgnored, "Input ignored event fired" );
                  }
               } );
            } );
         } );
      </script>
   </head>
   <body>
      <div id="txtDiv" style="padding-bottom: 25px;">
      </div>

      <div id="qunit"></div>
      <div id="qunit-fixture"></div>
   </body>
</html>
